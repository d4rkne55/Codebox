function getSelectedText(){var e=document.activeElement,t=["textarea","input"];return t.indexOf(e.tagName.toLowerCase())>-1?e.value.substring(e.selectionStart,e.selectionEnd):window.getSelection?window.getSelection().toString():!1}function errorsOnLines(e){e="undefined"==typeof e?!0:e;var t=lineNumbers.querySelectorAll(".error");t.forEach(function(e){e.className=""}),e&&(t=window.outputFrame.document.querySelectorAll(".error-line"),t.forEach(function(e){var t=e.innerHTML-1;lineNumbers.childNodes[t].className="error"}))}function runCode(e){e&&$.post("",{code:e},function(e){window.outputFrame.document.body.innerHTML=e,errorsOnLines()})}function updateLineNumbers(e,t){setTimeout(function(){t=t||!1,e=e||txtArea.value.split("\n").length;var n=lineNumbers.childNodes.length;if(t&&(lineNumbers.innerHTML="",n=1),e>n||t){t||(n+=1);for(var r=document.createDocumentFragment(),a=n;e>=a;a++){var i=document.createElement("span");i.appendChild(document.createTextNode(a)),r.appendChild(i)}lineNumbers.appendChild(r)}else if(n>e)for(var a=n;a>e;a--)lineNumbers.removeChild(lineNumbers.lastElementChild)},0)}function regexTester(e){var t=txtArea.value;t=t.split("\n");for(var n=0;n<t.length;n++)console.log(t[n].match(e))}var txtArea=document.querySelector("textarea.code"),lineNumbers=document.querySelector(".line-numbers");$(document).ready(function(){sessionStorage.getItem("autosave")&&(txtArea.value=sessionStorage.getItem("autosave")),updateLineNumbers(),autosize(txtArea),document.addEventListener("keydown",function(e){if(27==e.which||e.ctrlKey&&73==e.which){var t;t=getSelectedText()?getSelectedText():txtArea.value;var n=t.split("\n").length,r=t.length-(n-1);0==r&&(n=0),alert("Letters: "+r+"\nLines: "+n)}e.metaKey&&e.shiftKey&&82==e.which&&(e.preventDefault(),sessionStorage.clear(),location.reload())}),txtArea.addEventListener("keydown",function(e){var t=txtArea.value,n=txtArea.selectionStart,r=txtArea.selectionEnd,a=getSelectedText(),i="    ",s=i.length,l="^( {4}|	|â€‚{4})";if(9==e.which){e.preventDefault();var o=t.substr(0,n),u=t.substring(r),c=n+s;if(a)e.shiftKey?(a=a.replace(new RegExp(l,"gm"),""),c=a.search(/[^\s]/)+o.length):a=a.replace(new RegExp("^","gm"),i),t=o+a+u;else if(e.shiftKey){o=t.substr(0,n-s);var d=t.substr(n-s,s);t=o+d.replace(new RegExp(l),"")+u,c=n-s}else t=o+i+u;txtArea.value=t,txtArea.selectionEnd=c}if(!a){if(8==e.which||37==e.which){var m=t.substr(0,n).lastIndexOf("\n")+1,h=t.substring(m,n),v=new RegExp(l+"+$");if(v.test(h)){if(e.preventDefault(),8==e.which){var o=t.substr(0,n-s),u=t.substring(n,t.length);txtArea.value=o+u}txtArea.selectionEnd=n-s}else 8==e.which&&!h&&n>0&&lineNumbers.removeChild(lineNumbers.lastElementChild)}if(39==e.which){var v=new RegExp(l);v.test(t.substring(n,t.length))&&(e.preventDefault(),txtArea.selectionStart=n+s)}}!a||e.ctrlKey||e.metaKey||updateLineNumbers(),13==e.which&&(e.ctrlKey?runCode(t):updateLineNumbers()),e.ctrlKey&&83==e.which&&sessionStorage.setItem("autosave",txtArea.value)}),txtArea.onpaste=txtArea.oncut=function(){updateLineNumbers()},txtArea.addEventListener("autosize:resized",function(){lineNumbers.style.height=txtArea.style.height}),document.querySelector(".btn-submit").onclick=function(){txtArea.value=txtArea.value.trim(),runCode(txtArea.value),sessionStorage.setItem("autosave",txtArea.value)}});