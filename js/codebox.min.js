function getSelectedText(){var e=document.activeElement,t=["textarea","input"];return t.indexOf(e.tagName.toLowerCase())>-1?e.value.substring(e.selectionStart,e.selectionEnd):window.getSelection?window.getSelection().toString():!1}function errorsOnLines(e){e="undefined"==typeof e?!0:e;var t=lineNumbers.querySelectorAll(".error");t.forEach(function(e){e.className=""}),e&&(t=window.outputFrame.document.querySelectorAll(".error-line"),t.forEach(function(e){var t=e.innerHTML-1,n=lineNumbers.childNodes[t];void 0!==n&&(n.className="error")}))}function runCode(e){e&&$.post("",{code:e},function(e){var t=window.outputFrame.document;t.open(),t.write(e),t.close(),errorsOnLines()})}function updateLineNumbers(e,t){setTimeout(function(){t=t||!1,e=e||txtArea.value.split("\n").length;var n=lineNumbers.childNodes.length;if(t&&(lineNumbers.innerHTML="",n=1),e>n||t){t||(n+=1);for(var r=document.createDocumentFragment(),a=n;e>=a;a++){var i=document.createElement("span");i.appendChild(document.createTextNode(a)),r.appendChild(i)}lineNumbers.appendChild(r)}else if(n>e)for(var a=n;a>e;a--)lineNumbers.removeChild(lineNumbers.lastElementChild)},0)}function regexTester(e){var t=txtArea.value;console.log(t.match(e))}var txtArea=document.querySelector("textarea.code"),lineNumbers=document.querySelector(".line-numbers");$(document).ready(function(){sessionStorage.getItem("autosave")&&(txtArea.value=sessionStorage.getItem("autosave")),updateLineNumbers(),autosize(txtArea),document.addEventListener("keydown",function(e){if(27==e.which||e.ctrlKey&&73==e.which){var t;t=getSelectedText()?getSelectedText():txtArea.value;var n=t.split("\n").length,r=t.length-(n-1);0==r&&(n=0),alert("Letters: "+r+"\nLines: "+n)}e.metaKey&&e.shiftKey&&82==e.which&&(e.preventDefault(),sessionStorage.clear(),location.reload())}),txtArea.addEventListener("keydown",function(e){var t=txtArea.value,n=txtArea.selectionStart,r=txtArea.selectionEnd,a=getSelectedText(),i="    ",o=i.length,s="^( {4}|	|â€‚{4})";if(9==e.which){e.preventDefault();var l=t.substr(0,n),u=t.substring(r),c=n+o;if(a)e.shiftKey?(a=a.replace(new RegExp(s,"gm"),""),c=a.search(/[^\s]/)+l.length):a=a.replace(new RegExp("^","gm"),i),t=l+a+u;else if(e.shiftKey){l=t.substr(0,n-o);var d=t.substr(n-o,o);t=l+d.replace(new RegExp(s),"")+u,c=n-o}else t=l+i+u;txtArea.value=t,txtArea.selectionEnd=c}if(!a){if(8==e.which||37==e.which){var m=t.substr(0,n).lastIndexOf("\n")+1,h=t.substring(m,n),v=new RegExp(s+"+$");if(v.test(h)){if(e.preventDefault(),8==e.which){var l=t.substr(0,n-o),u=t.substring(n,t.length);txtArea.value=l+u}txtArea.selectionEnd=n-o}else 8==e.which&&!h&&n>0&&lineNumbers.removeChild(lineNumbers.lastElementChild)}if(39==e.which){var v=new RegExp(s);v.test(t.substring(n,t.length))&&(e.preventDefault(),txtArea.selectionStart=n+o)}}!a||e.ctrlKey||e.metaKey||updateLineNumbers(),13==e.which&&(e.ctrlKey?runCode(t):updateLineNumbers()),e.ctrlKey&&83==e.which&&sessionStorage.setItem("autosave",txtArea.value)}),txtArea.onpaste=txtArea.oncut=function(){updateLineNumbers()},txtArea.addEventListener("autosize:resized",function(){lineNumbers.style.height=txtArea.style.height}),document.querySelector(".btn-submit").onclick=function(){txtArea.value=txtArea.value.trim(),sessionStorage.setItem("autosave",txtArea.value);var e=document.createElement("form");e.name="codebox",e.method="post",e.style.display="none";var t=txtArea.cloneNode(!1);t.value=txtArea.value,e.appendChild(t),document.body.appendChild(e),document.codebox.submit()}});